# Retrieval Augmented Generation

## RAG 是什么

通过 **Retrieval Augmented Generation(RAG, 检索增强生成)** 的能力, 将检索/搜索的能力集成到 LLMs 的文本生成中. 通过 RAG 从大型语料库中获取相关文档, 通过设计特定的 prompt, 将这些文档片段与输入融合, 使用 LLMs 的能力, 参考这些文档知识, 在知识密集型的任务上, 给出更为精确的答案.

![](/resources/images/llm/rag-1.png)

![](/resources/images/llm/rag-2.png)

RAG 是一个混合框架, 有两个主要组件: 检索模型和生成模型. 因此, RAG 系统的整体效果就取决于这两个组件.

- 检索模型
  - 被检索数据的组织形式 / 数据分块 / 索引形式
  - 高效而准确的检索召回方法
  - 多项检索内容的质量评价(排序), 在 prompt 中的顺序问题
  - Prompt 的设计, 降低噪音, 提升输入的信息量才能获得更好的生成结果
- 生成模型
  - 模型中包含的知识多少
  - 模型对 instruction 响应的能力 / 模型对 prompt 的敏感度
  - 模型的幻觉问题

## RAG 实践

### 数据准备

**成功实施 RAG 的基石是数据质量**. 必须投入时间和精力进行数据清理和预处理, 以实现最佳模型性能.

需要文本规范化, 其中涉及**标准化文本格式**以及**实体识别和解析**, 这有助于模型识别文本中的关键元素并将其检索召回, 置于 prompt 上下文中.

此外, 消除不相关或敏感信息, 例如个人身份信息, 对于符合隐私标准至关重要.

### 定期更新

RAG 依靠实时或频繁更新的信息. 建立强大的数据管道, 允许定期更新数据源. 这些更新的频率可以从每天到每季度不等, 具体取决于具体使用场景.

需要使用自动化工作流程来处理此过程, 例如开源的 [LangStream](https://github.com/LangStream/langstream) 等框架可以将流媒体与嵌入模型结合起来, 使定期更新这项任务变得更容易.

### 输出评估

这可能需要一个领域专家小组仔细审查模型输出的样本集. 给出输出与输入的经验总结.

### 持续迭代

更新训练数据, 修改模型参数, 甚至根据最新的研究和性能指标调整架构设置.

### 端到端集成

持续集成和持续部署. 实施强大的监控系统以及进行定期模型审核.

## RAG 的问题

- 最明显的缺点之一是模型的复杂性. 结合了检索和生成组件, 整体架构变得更加复杂, 需要更多的计算能力, 并使调试更加复杂(对最终输出产生影响的因素太多, 不好分析)
- 数据准备困难: 提供干净, 非冗余的文本, 然后开发和测试一种将文本分块为对生成模型有用的片段的方法. 如何分块, 也是一个挑战
- 检索准确性的把控: 必须找到一个对潜在的大量且多样化的信息中表现良好的嵌入模型, 或者其他的召回方式
- LLMs 通常需要 prompt 的工程设计, 检索带来的信息需要正确构建, 才能够使 LLMs 生成高质量的响应
- 性能权衡. 检索然后生成文本, 可能会增加实时应用程序中的延迟, 必须决定如何平衡检索深度和响应速度, 尤其是在时间敏感的情况下

# 参考资料

- [Elasticsearch：什么是检索增强生成 - RAG？](https://blog.csdn.net/UbuntuTouch/article/details/133746882)
