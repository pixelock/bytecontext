记录不同模型在 vLLM 框架上的推理表现.

# 影响推理速度的因素

**输入输出**

- 输入长度: 影响推理的的 prefill 阶段将输入转化为 KV cache 的耗时. 输入越长, 这个阶段耗时越长.
- 输出长度: 显而易见生成的 tokens 数量越多耗时越长, 且随着生成内容的变长, 每个 token 的生成耗时也会增加.

**服务端**

- [启动参数](https://docs.vllm.ai/en/latest/models/engine_args.html#): vLLM 在启动服务时, 以下的几个参数会影响到服务端的性能:
  - dtype: 模型参数的精度, `{auto,half,float16,bfloat16,float,float32}`
  - max-model-len: 输入+输出的长度上限, 超过这个长度, 服务端会拒绝请求. 不指定的则使用模型 `config` 中的设置
  - pipeline-parallel-size(pp): Pipeline 并行大小
  - tensor-parallel- Tensor 并行大小
  - block-size: 默认为16, `{8,16,32}`
  - quantization: 是否使用量化, `{awq,squeezellm,None}`

**模型端**

- 参数量

**硬件**

- GPU 性能
- GPU 数量

# 通用配置

## 变量

我们设置两组变量: **输入长度**和**输出长度**. 原因是不同长度下的性能表现差异很大, 而实际业务场景中常常会偏向于一种, 例如:

> RAG: 输入中会包含很多 chunks, 输入一般都是超长的 prompt
> 分类器: 使用大模型做分类器, 经常会包含 few-shot samples, 往往 prompt 也是超长的文本, 但输出一般是很短的文本
> 用户问改写: 根据历史的输入输出, 对当前的用户 query 进行改写, 将用户简短的句子扩充为语义完整的句子, 方便后续流程(如 RAG 中的文档召回) 使用

因此, 使用官方的脚本, 可以快速的对模型的性能进行大致的评估. 细致的性能评估, 对实际业务使用的技术方案更有指导意义.

## 启动参数

如无特殊说明, 实验均使用以下的参数启动 vLLM 服务:

```bash
python -m vllm.entrypoints.openai.api_server --model [model-name] --tensor-parallel-size 4 --dtype float16
```
## Prompt

测试过简单重复生成, 总结, 翻译, 续写等类型的 Prompt, 一些模型生成时存在一定的问题:

- 不好控制输出的长度
- 某些模型生成长文本(例如大于1000字)时会存在问题, 难以生成或明确拒绝生成

由于我们的实验需要评测不同长度的输入输出, 来模拟在实际场景中的各种情景, 综合考虑使用续写的模版测试. 模版中会指定生成的长度, 但不同的模型对该长度的遵循效果不同, 因此需要使用实际生成的长度来评测.

使用的 prompt 为:

```
"""
{text}
"""

阅读上面的文本，续写后面的内容, 要求续写 {num_completion} 个字左右:
```

# [SUSTech/SUS-Chat-34B](https://huggingface.co/SUSTech/SUS-Chat-34B)

## A100-PCIE-40G

### 详细测试

**input 100**

输出长度 | completion-tokens/s
---|---
166 | 522.0628
169 | 382.0678
236 | 374.0512
264 | 453.6271
358 | 458.1288

**input 500**

输出长度 | completion-tokens/s
---|---
224 | 429.3549
332 | 406.4482
481 | 456.4042
556 | 408.9847
593 | 446.6986

**input 1000**

输出长度 | completion-tokens/s
---|---
226 | 358.5796
403 | 377.2007
573 | 359.1306
592 | 349.9870
617 | 333.6339

**input 2000**

输出长度 | completion-tokens/s
---|---
220 | 191.3384
563 | 215.6070
672 | 224.5382
697 | 193.8919
754 | 202.6355

**input 4000**

输出长度 | completion-tokens/s
---|---
245 | 97.5106
672 | 142.7740
744 | 140.7975
804 | 142.3059
809 | 145.8368

**总结**

![](/resources/images/llm/vllm-spped-2.png)

## V100-PCIE-32G

### benchmark 测试

**使用的指令**

```bash
python benchmark_serving.py --dataset ShareGPT_V3_unfiltered_cleaned_split.json --tokenizer /data/SUS-Chat-34B/ --request-rate 32 --num-prompts 1000
```

**使用的数据集**

[ShareGPT dataset](https://huggingface.co/datasets/anon8231489123/ShareGPT_Vicuna_unfiltered/resolve/main/ShareGPT_V3_unfiltered_cleaned_split.json)

下载:

```bash
wget https://huggingface.co/datasets/anon8231489123/ShareGPT_Vicuna_unfiltered/resolve/main/ShareGPT_V3_unfiltered_cleaned_split.json
```

**实验数据**

```
Total time: 842.46 s
Throughput: 1.19 requests/s
Average latency: 429.69 s
Average latency per token: 1.67 s
Average latency per output token: 8.67 s
Completion tokens per second: 259.7170681239465 tokens/s
```

### 详细测试

**input 100**

输出长度 | completion-tokens/s
---|---
171 | 120.2293
185 | 113.6797
243 | 119.0702
297 | 138.0233
361 | 149.4582

**input 500**

输出长度 | completion-tokens/s
---|---
212 | 95.2401
314 | 106.9344
509 | 124.1921
582 | 138.8510
602 | 133.6348

**input 1000**

输出长度 | completion-tokens/s
---|---
211 | 68.6720
434 | 93.4956
627 | 111.3533
639 | 107.6462
683 | 106.5405

**input 2000**

输出长度 | completion-tokens/s
---|---
215 | 49.2735
563 | 80.6125
624 | 84.7432
705 | 84.2393
723 | 84.8315

**input 4000**

输出长度 | completion-tokens/s
---|---
202 | 28.0435
580 | 53.2384
620 | 53.1781
641 | 52.4234
682 | 51.6965

**总结**

![](/resources/images/llm/vllm-spped-1.png)

长输入, 短输出的效率是最低的, 因为需要耗费大量的时间生成 prefill 的 KV cache, 但生成后只做了简短的生成就要销毁.

**完整日志记录**

```
[2023-12-20 09:35:28,585][261][INFO] chunk_size: 4000, generate_size: 4000
[2023-12-20 10:06:56,483][243][INFO] 总测试文本块数目: 500
[2023-12-20 10:06:56,483][244][INFO] 并发: 16
[2023-12-20 10:06:56,483][245][INFO] 单个文本块长度: 4000
[2023-12-20 10:06:56,484][246][INFO] 生成文本长度: 4000
[2023-12-20 10:06:56,484][46][INFO] duration: 1888
[2023-12-20 10:06:56,484][47][INFO] prompt-tokens/second: 306.7574152542373
[2023-12-20 10:06:56,484][48][INFO] completion-tokens/second: 51.69650423728814
[2023-12-20 10:06:56,484][49][INFO] prompt-chars/second: 304.9518008474576
[2023-12-20 10:06:56,484][50][INFO] completion-chars/second: 69.00900423728814
[2023-12-20 10:06:56,484][51][INFO] total completion tokens: 97603
[2023-12-20 10:06:56,484][52][INFO] completion tokens per request: 682.5384615384615
[2023-12-20 10:06:56,484][53][INFO] n-request: 143
[2023-12-20 10:06:56,484][54][INFO] QPS: 0.07574152542372882
[2023-12-20 10:06:56,484][55][INFO] tokens-speed-per-request/second(终端用户视角): 4.691109948682602
[2023-12-20 10:06:56,484][247][INFO] None
[2023-12-20 10:06:56,484][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 10:06:56,486][261][INFO] chunk_size: 4000, generate_size: 2000
[2023-12-20 10:37:31,149][243][INFO] 总测试文本块数目: 500
[2023-12-20 10:37:31,149][244][INFO] 并发: 16
[2023-12-20 10:37:31,149][245][INFO] 单个文本块长度: 4000
[2023-12-20 10:37:31,149][246][INFO] 生成文本长度: 2000
[2023-12-20 10:37:31,149][46][INFO] duration: 1835
[2023-12-20 10:37:31,149][47][INFO] prompt-tokens/second: 331.6365122615804
[2023-12-20 10:37:31,149][48][INFO] completion-tokens/second: 52.42343324250681
[2023-12-20 10:37:31,149][49][INFO] prompt-chars/second: 329.1825613079019
[2023-12-20 10:37:31,149][50][INFO] completion-chars/second: 73.62234332425068
[2023-12-20 10:37:31,149][51][INFO] total completion tokens: 96197
[2023-12-20 10:37:31,149][52][INFO] completion tokens per request: 641.3133333333334
[2023-12-20 10:37:31,149][53][INFO] n-request: 150
[2023-12-20 10:37:31,149][54][INFO] QPS: 0.08174386920980926
[2023-12-20 10:37:31,149][55][INFO] tokens-speed-per-request/second(终端用户视角): 4.423931060524343
[2023-12-20 10:37:31,150][247][INFO] None
[2023-12-20 10:37:31,150][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 10:37:31,151][261][INFO] chunk_size: 4000, generate_size: 1000
[2023-12-20 11:07:05,989][243][INFO] 总测试文本块数目: 500
[2023-12-20 11:07:05,989][244][INFO] 并发: 16
[2023-12-20 11:07:05,989][245][INFO] 单个文本块长度: 4000
[2023-12-20 11:07:05,989][246][INFO] 生成文本长度: 1000
[2023-12-20 11:07:05,989][46][INFO] duration: 1774
[2023-12-20 11:07:05,989][47][INFO] prompt-tokens/second: 347.1894024802706
[2023-12-20 11:07:05,989][48][INFO] completion-tokens/second: 53.17812852311161
[2023-12-20 11:07:05,990][49][INFO] prompt-chars/second: 345.0597519729425
[2023-12-20 11:07:05,990][50][INFO] completion-chars/second: 71.53382187147689
[2023-12-20 11:07:05,990][51][INFO] total completion tokens: 94338
[2023-12-20 11:07:05,990][52][INFO] completion tokens per request: 620.6447368421053
[2023-12-20 11:07:05,990][53][INFO] n-request: 152
[2023-12-20 11:07:05,990][54][INFO] QPS: 0.08568207440811725
[2023-12-20 11:07:05,990][55][INFO] tokens-speed-per-request/second(终端用户视角): 4.339159927331463
[2023-12-20 11:07:05,990][247][INFO] None
[2023-12-20 11:07:05,990][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 11:07:05,992][261][INFO] chunk_size: 4000, generate_size: 500
[2023-12-20 11:35:37,752][243][INFO] 总测试文本块数目: 500
[2023-12-20 11:35:37,752][244][INFO] 并发: 16
[2023-12-20 11:35:37,752][245][INFO] 单个文本块长度: 4000
[2023-12-20 11:35:37,752][246][INFO] 生成文本长度: 500
[2023-12-20 11:35:37,752][46][INFO] duration: 1711
[2023-12-20 11:35:37,752][47][INFO] prompt-tokens/second: 371.5558153126826
[2023-12-20 11:35:37,752][48][INFO] completion-tokens/second: 53.23845704266511
[2023-12-20 11:35:37,752][49][INFO] prompt-chars/second: 369.48801870251316
[2023-12-20 11:35:37,752][50][INFO] completion-chars/second: 70.60374050263005
[2023-12-20 11:35:37,752][51][INFO] total completion tokens: 91091
[2023-12-20 11:35:37,752][52][INFO] completion tokens per request: 580.1974522292994
[2023-12-20 11:35:37,752][53][INFO] n-request: 157
[2023-12-20 11:35:37,752][54][INFO] QPS: 0.09175920514319112
[2023-12-20 11:35:37,752][55][INFO] tokens-speed-per-request/second(终端用户视角): 4.162039080990637
[2023-12-20 11:35:37,752][247][INFO] None
[2023-12-20 11:35:37,752][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 11:35:37,754][261][INFO] chunk_size: 4000, generate_size: 100
[2023-12-20 11:55:31,321][243][INFO] 总测试文本块数目: 500
[2023-12-20 11:55:31,321][244][INFO] 并发: 16
[2023-12-20 11:55:31,321][245][INFO] 单个文本块长度: 4000
[2023-12-20 11:55:31,321][246][INFO] 生成文本长度: 100
[2023-12-20 11:55:31,321][46][INFO] duration: 1194
[2023-12-20 11:55:31,321][47][INFO] prompt-tokens/second: 559.8433835845896
[2023-12-20 11:55:31,321][48][INFO] completion-tokens/second: 28.04355108877722
[2023-12-20 11:55:31,321][49][INFO] prompt-chars/second: 556.5577889447236
[2023-12-20 11:55:31,321][50][INFO] completion-chars/second: 36.902010050251256
[2023-12-20 11:55:31,322][51][INFO] total completion tokens: 33484
[2023-12-20 11:55:31,322][52][INFO] completion tokens per request: 202.93333333333334
[2023-12-20 11:55:31,322][53][INFO] n-request: 165
[2023-12-20 11:55:31,322][54][INFO] QPS: 0.13819095477386933
[2023-12-20 11:55:31,322][55][INFO] tokens-speed-per-request/second(终端用户视角): 1.9678374117581292
[2023-12-20 11:55:31,322][247][INFO] None
[2023-12-20 11:55:31,322][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 11:55:31,323][261][INFO] chunk_size: 2000, generate_size: 4000
[2023-12-20 12:40:43,022][243][INFO] 总测试文本块数目: 500
[2023-12-20 12:40:43,022][244][INFO] 并发: 16
[2023-12-20 12:40:43,022][245][INFO] 单个文本块长度: 2000
[2023-12-20 12:40:43,022][246][INFO] 生成文本长度: 4000
[2023-12-20 12:40:43,022][46][INFO] duration: 2712
[2023-12-20 12:40:43,022][47][INFO] prompt-tokens/second: 273.2031710914454
[2023-12-20 12:40:43,022][48][INFO] completion-tokens/second: 84.23930678466077
[2023-12-20 12:40:43,022][49][INFO] prompt-chars/second: 243.92772861356931
[2023-12-20 12:40:43,022][50][INFO] completion-chars/second: 114.48156342182891
[2023-12-20 12:40:43,022][51][INFO] total completion tokens: 228457
[2023-12-20 12:40:43,022][52][INFO] completion tokens per request: 705.1141975308642
[2023-12-20 12:40:43,022][53][INFO] n-request: 324
[2023-12-20 12:40:43,022][54][INFO] QPS: 0.11946902654867257
[2023-12-20 12:40:43,022][55][INFO] tokens-speed-per-request/second(终端用户视角): 6.274796022519489
[2023-12-20 12:40:43,022][247][INFO] None
[2023-12-20 12:40:43,022][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 12:40:43,024][261][INFO] chunk_size: 2000, generate_size: 2000
[2023-12-20 13:26:13,054][243][INFO] 总测试文本块数目: 500
[2023-12-20 13:26:13,054][244][INFO] 并发: 16
[2023-12-20 13:26:13,054][245][INFO] 单个文本块长度: 2000
[2023-12-20 13:26:13,054][246][INFO] 生成文本长度: 2000
[2023-12-20 13:26:13,054][46][INFO] duration: 2730
[2023-12-20 13:26:13,054][47][INFO] prompt-tokens/second: 268.1882783882784
[2023-12-20 13:26:13,054][48][INFO] completion-tokens/second: 84.83150183150182
[2023-12-20 13:26:13,054][49][INFO] prompt-chars/second: 239.32600732600733
[2023-12-20 13:26:13,054][50][INFO] completion-chars/second: 115.9908424908425
[2023-12-20 13:26:13,055][51][INFO] total completion tokens: 231590
[2023-12-20 13:26:13,055][52][INFO] completion tokens per request: 723.71875
[2023-12-20 13:26:13,055][53][INFO] n-request: 320
[2023-12-20 13:26:13,055][54][INFO] QPS: 0.11721611721611722
[2023-12-20 13:26:13,055][55][INFO] tokens-speed-per-request/second(终端用户视角): 6.381295584042801
[2023-12-20 13:26:13,055][247][INFO] None
[2023-12-20 13:26:13,055][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 13:26:13,056][261][INFO] chunk_size: 2000, generate_size: 1000
[2023-12-20 14:06:43,408][243][INFO] 总测试文本块数目: 500
[2023-12-20 14:06:43,408][244][INFO] 并发: 16
[2023-12-20 14:06:43,408][245][INFO] 单个文本块长度: 2000
[2023-12-20 14:06:43,408][246][INFO] 生成文本长度: 1000
[2023-12-20 14:06:43,408][46][INFO] duration: 2430
[2023-12-20 14:06:43,408][47][INFO] prompt-tokens/second: 310.80123456790125
[2023-12-20 14:06:43,408][48][INFO] completion-tokens/second: 84.7432098765432
[2023-12-20 14:06:43,408][49][INFO] prompt-chars/second: 277.2798353909465
[2023-12-20 14:06:43,408][50][INFO] completion-chars/second: 118.62345679012346
[2023-12-20 14:06:43,409][51][INFO] total completion tokens: 205926
[2023-12-20 14:06:43,409][52][INFO] completion tokens per request: 624.0181818181818
[2023-12-20 14:06:43,409][53][INFO] n-request: 330
[2023-12-20 14:06:43,409][54][INFO] QPS: 0.13580246913580246
[2023-12-20 14:06:43,409][55][INFO] tokens-speed-per-request/second(终端用户视角): 5.922787446112292
[2023-12-20 14:06:43,409][247][INFO] None
[2023-12-20 14:06:43,409][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 14:06:43,411][261][INFO] chunk_size: 2000, generate_size: 500
[2023-12-20 14:44:42,420][243][INFO] 总测试文本块数目: 500
[2023-12-20 14:44:42,420][244][INFO] 并发: 16
[2023-12-20 14:44:42,421][245][INFO] 单个文本块长度: 2000
[2023-12-20 14:44:42,421][246][INFO] 生成文本长度: 500
[2023-12-20 14:44:42,421][46][INFO] duration: 2279
[2023-12-20 14:44:42,421][47][INFO] prompt-tokens/second: 327.0315928038613
[2023-12-20 14:44:42,421][48][INFO] completion-tokens/second: 80.61254936375603
[2023-12-20 14:44:42,421][49][INFO] prompt-chars/second: 291.9227731461167
[2023-12-20 14:44:42,421][50][INFO] completion-chars/second: 112.08995173321632
[2023-12-20 14:44:42,421][51][INFO] total completion tokens: 183716
[2023-12-20 14:44:42,421][52][INFO] completion tokens per request: 563.5460122699386
[2023-12-20 14:44:42,421][53][INFO] n-request: 326
[2023-12-20 14:44:42,421][54][INFO] QPS: 0.14304519526107942
[2023-12-20 14:44:42,421][55][INFO] tokens-speed-per-request/second(终端用户视角): 5.701695981804034
[2023-12-20 14:44:42,421][247][INFO] None
[2023-12-20 14:44:42,421][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 14:44:42,423][261][INFO] chunk_size: 2000, generate_size: 100
[2023-12-20 15:09:15,233][243][INFO] 总测试文本块数目: 500
[2023-12-20 15:09:15,234][244][INFO] 并发: 16
[2023-12-20 15:09:15,234][245][INFO] 单个文本块长度: 2000
[2023-12-20 15:09:15,234][246][INFO] 生成文本长度: 100
[2023-12-20 15:09:15,234][46][INFO] duration: 1473
[2023-12-20 15:09:15,234][47][INFO] prompt-tokens/second: 523.2525458248473
[2023-12-20 15:09:15,234][48][INFO] completion-tokens/second: 49.27359131025119
[2023-12-20 15:09:15,234][49][INFO] prompt-chars/second: 466.9069925322471
[2023-12-20 15:09:15,234][50][INFO] completion-chars/second: 67.77189409368636
[2023-12-20 15:09:15,234][51][INFO] total completion tokens: 72580
[2023-12-20 15:09:15,234][52][INFO] completion tokens per request: 215.37091988130564
[2023-12-20 15:09:15,234][53][INFO] n-request: 337
[2023-12-20 15:09:15,234][54][INFO] QPS: 0.2287847929395791
[2023-12-20 15:09:15,234][55][INFO] tokens-speed-per-request/second(终端用户视角): 3.1839140031063176
[2023-12-20 15:09:15,234][247][INFO] None
[2023-12-20 15:09:15,234][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 15:09:15,236][261][INFO] chunk_size: 1000, generate_size: 4000
[2023-12-20 16:00:48,663][243][INFO] 总测试文本块数目: 500
[2023-12-20 16:00:48,663][244][INFO] 并发: 16
[2023-12-20 16:00:48,663][245][INFO] 单个文本块长度: 1000
[2023-12-20 16:00:48,663][246][INFO] 生成文本长度: 4000
[2023-12-20 16:00:48,663][46][INFO] duration: 3093
[2023-12-20 16:00:48,663][47][INFO] prompt-tokens/second: 218.26705463950856
[2023-12-20 16:00:48,663][48][INFO] completion-tokens/second: 106.54057549304882
[2023-12-20 16:00:48,663][49][INFO] prompt-chars/second: 162.5366957646298
[2023-12-20 16:00:48,663][50][INFO] completion-chars/second: 151.47365017782087
[2023-12-20 16:00:48,663][51][INFO] total completion tokens: 329530
[2023-12-20 16:00:48,664][52][INFO] completion tokens per request: 683.6721991701245
[2023-12-20 16:00:48,664][53][INFO] n-request: 482
[2023-12-20 16:00:48,664][54][INFO] QPS: 0.1558357581635952
[2023-12-20 16:00:48,664][55][INFO] tokens-speed-per-request/second(终端用户视角): 7.736607214713162
[2023-12-20 16:00:48,664][247][INFO] None
[2023-12-20 16:00:48,664][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 16:00:48,665][261][INFO] chunk_size: 1000, generate_size: 2000
[2023-12-20 16:48:54,882][243][INFO] 总测试文本块数目: 500
[2023-12-20 16:48:54,882][244][INFO] 并发: 16
[2023-12-20 16:48:54,883][245][INFO] 单个文本块长度: 1000
[2023-12-20 16:48:54,883][246][INFO] 生成文本长度: 2000
[2023-12-20 16:48:54,883][46][INFO] duration: 2886
[2023-12-20 16:48:54,883][47][INFO] prompt-tokens/second: 235.86001386001385
[2023-12-20 16:48:54,883][48][INFO] completion-tokens/second: 107.64622314622315
[2023-12-20 16:48:54,883][49][INFO] prompt-chars/second: 175.64033264033264
[2023-12-20 16:48:54,883][50][INFO] completion-chars/second: 151.86555786555786
[2023-12-20 16:48:54,883][51][INFO] total completion tokens: 310667
[2023-12-20 16:48:54,883][52][INFO] completion tokens per request: 639.2325102880659
[2023-12-20 16:48:54,883][53][INFO] n-request: 486
[2023-12-20 16:48:54,883][54][INFO] QPS: 0.1683991683991684
[2023-12-20 16:48:54,883][55][INFO] tokens-speed-per-request/second(终端用户视角): 7.6153075593092305
[2023-12-20 16:48:54,883][247][INFO] None
[2023-12-20 16:48:54,883][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 16:48:54,884][261][INFO] chunk_size: 1000, generate_size: 1000
[2023-12-20 17:34:59,400][243][INFO] 总测试文本块数目: 500
[2023-12-20 17:34:59,400][244][INFO] 并发: 16
[2023-12-20 17:34:59,401][245][INFO] 单个文本块长度: 1000
[2023-12-20 17:34:59,401][246][INFO] 生成文本长度: 1000
[2023-12-20 17:34:59,401][46][INFO] duration: 2765
[2023-12-20 17:34:59,401][47][INFO] prompt-tokens/second: 248.68969258589513
[2023-12-20 17:34:59,401][48][INFO] completion-tokens/second: 111.35334538878843
[2023-12-20 17:34:59,401][49][INFO] prompt-chars/second: 185.2126582278481
[2023-12-20 17:34:59,401][50][INFO] completion-chars/second: 155.68282097649185
[2023-12-20 17:34:59,401][51][INFO] total completion tokens: 307892
[2023-12-20 17:34:59,401][52][INFO] completion tokens per request: 627.0712830957231
[2023-12-20 17:34:59,401][53][INFO] n-request: 491
[2023-12-20 17:34:59,401][54][INFO] QPS: 0.1775768535262206
[2023-12-20 17:34:59,401][55][INFO] tokens-speed-per-request/second(终端用户视角): 7.525947551892652
[2023-12-20 17:34:59,401][247][INFO] None
[2023-12-20 17:34:59,401][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 17:34:59,402][261][INFO] chunk_size: 1000, generate_size: 500
[2023-12-20 18:13:17,959][243][INFO] 总测试文本块数目: 500
[2023-12-20 18:13:17,959][244][INFO] 并发: 16
[2023-12-20 18:13:17,959][245][INFO] 单个文本块长度: 1000
[2023-12-20 18:13:17,959][246][INFO] 生成文本长度: 500
[2023-12-20 18:13:17,959][46][INFO] duration: 2298
[2023-12-20 18:13:17,959][47][INFO] prompt-tokens/second: 301.43994778067884
[2023-12-20 18:13:17,959][48][INFO] completion-tokens/second: 93.49564838990426
[2023-12-20 18:13:17,959][49][INFO] prompt-chars/second: 224.45169712793734
[2023-12-20 18:13:17,959][50][INFO] completion-chars/second: 132.87293298520453
[2023-12-20 18:13:17,959][51][INFO] total completion tokens: 214853
[2023-12-20 18:13:17,959][52][INFO] completion tokens per request: 434.04646464646464
[2023-12-20 18:13:17,960][53][INFO] n-request: 495
[2023-12-20 18:13:17,960][54][INFO] QPS: 0.2154046997389034
[2023-12-20 18:13:17,960][55][INFO] tokens-speed-per-request/second(终端用户视角): 6.527021550073426
[2023-12-20 18:13:17,960][247][INFO] None
[2023-12-20 18:13:17,960][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 18:13:17,961][261][INFO] chunk_size: 1000, generate_size: 100
[2023-12-20 18:38:54,300][243][INFO] 总测试文本块数目: 500
[2023-12-20 18:38:54,300][244][INFO] 并发: 16
[2023-12-20 18:38:54,300][245][INFO] 单个文本块长度: 1000
[2023-12-20 18:38:54,300][246][INFO] 生成文本长度: 100
[2023-12-20 18:38:54,300][46][INFO] duration: 1537
[2023-12-20 18:38:54,300][47][INFO] prompt-tokens/second: 453.46714378659726
[2023-12-20 18:38:54,300][48][INFO] completion-tokens/second: 68.67208848405986
[2023-12-20 18:38:54,300][49][INFO] prompt-chars/second: 337.6161353285621
[2023-12-20 18:38:54,300][50][INFO] completion-chars/second: 95.86011711125569
[2023-12-20 18:38:54,300][51][INFO] total completion tokens: 105549
[2023-12-20 18:38:54,301][52][INFO] completion tokens per request: 211.94578313253012
[2023-12-20 18:38:54,301][53][INFO] n-request: 498
[2023-12-20 18:38:54,301][54][INFO] QPS: 0.3240078074170462
[2023-12-20 18:38:54,301][55][INFO] tokens-speed-per-request/second(终端用户视角): 4.439097894633548
[2023-12-20 18:38:54,301][247][INFO] None
[2023-12-20 18:38:54,301][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 18:38:54,302][261][INFO] chunk_size: 500, generate_size: 4000
[2023-12-20 19:15:03,456][243][INFO] 总测试文本块数目: 500
[2023-12-20 19:15:03,457][244][INFO] 并发: 25
[2023-12-20 19:15:03,457][245][INFO] 单个文本块长度: 500
[2023-12-20 19:15:03,457][246][INFO] 生成文本长度: 4000
[2023-12-20 19:15:03,457][46][INFO] duration: 2169
[2023-12-20 19:15:03,457][47][INFO] prompt-tokens/second: 211.850622406639
[2023-12-20 19:15:03,457][48][INFO] completion-tokens/second: 133.63485477178423
[2023-12-20 19:15:03,457][49][INFO] prompt-chars/second: 120.41632088520055
[2023-12-20 19:15:03,457][50][INFO] completion-chars/second: 192.3554633471646
[2023-12-20 19:15:03,457][51][INFO] total completion tokens: 289854
[2023-12-20 19:15:03,457][52][INFO] completion tokens per request: 602.6070686070686
[2023-12-20 19:15:03,457][53][INFO] n-request: 481
[2023-12-20 19:15:03,457][54][INFO] QPS: 0.22176118026740432
[2023-12-20 19:15:03,457][55][INFO] tokens-speed-per-request/second(终端用户视角): 6.180418417807418
[2023-12-20 19:15:03,457][247][INFO] None
[2023-12-20 19:15:03,457][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 19:15:03,460][261][INFO] chunk_size: 500, generate_size: 2000
[2023-12-20 19:49:17,997][243][INFO] 总测试文本块数目: 500
[2023-12-20 19:49:17,997][244][INFO] 并发: 25
[2023-12-20 19:49:17,997][245][INFO] 单个文本块长度: 500
[2023-12-20 19:49:17,997][246][INFO] 生成文本长度: 2000
[2023-12-20 19:49:17,997][46][INFO] duration: 2054
[2023-12-20 19:49:17,997][47][INFO] prompt-tokens/second: 227.91187925998054
[2023-12-20 19:49:17,997][48][INFO] completion-tokens/second: 138.8510223953262
[2023-12-20 19:49:17,998][49][INFO] prompt-chars/second: 129.53748782862706
[2023-12-20 19:49:17,998][50][INFO] completion-chars/second: 198.50535540408958
[2023-12-20 19:49:17,998][51][INFO] total completion tokens: 285200
[2023-12-20 19:49:17,998][52][INFO] completion tokens per request: 582.0408163265306
[2023-12-20 19:49:17,998][53][INFO] n-request: 490
[2023-12-20 19:49:17,998][54][INFO] QPS: 0.2385589094449854
[2023-12-20 19:49:17,998][55][INFO] tokens-speed-per-request/second(终端用户视角): 6.06714175973334
[2023-12-20 19:49:17,998][247][INFO] None
[2023-12-20 19:49:17,998][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 19:49:18,000][261][INFO] chunk_size: 500, generate_size: 1000
[2023-12-20 20:22:16,712][243][INFO] 总测试文本块数目: 500
[2023-12-20 20:22:16,712][244][INFO] 并发: 25
[2023-12-20 20:22:16,712][245][INFO] 单个文本块长度: 500
[2023-12-20 20:22:16,712][246][INFO] 生成文本长度: 1000
[2023-12-20 20:22:16,712][46][INFO] duration: 1978
[2023-12-20 20:22:16,712][47][INFO] prompt-tokens/second: 232.845298281092
[2023-12-20 20:22:16,712][48][INFO] completion-tokens/second: 124.19211324570273
[2023-12-20 20:22:16,712][49][INFO] prompt-chars/second: 132.3185035389282
[2023-12-20 20:22:16,712][50][INFO] completion-chars/second: 178.1107178968655
[2023-12-20 20:22:16,712][51][INFO] total completion tokens: 245652
[2023-12-20 20:22:16,712][52][INFO] completion tokens per request: 509.65145228215766
[2023-12-20 20:22:16,712][53][INFO] n-request: 482
[2023-12-20 20:22:16,712][54][INFO] QPS: 0.243680485338726
[2023-12-20 20:22:16,712][55][INFO] tokens-speed-per-request/second(终端用户视角): 5.923024302626988
[2023-12-20 20:22:16,712][247][INFO] None
[2023-12-20 20:22:16,712][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 20:22:16,715][261][INFO] chunk_size: 500, generate_size: 500
[2023-12-20 20:46:11,262][243][INFO] 总测试文本块数目: 500
[2023-12-20 20:46:11,263][244][INFO] 并发: 25
[2023-12-20 20:46:11,263][245][INFO] 单个文本块长度: 500
[2023-12-20 20:46:11,263][246][INFO] 生成文本长度: 500
[2023-12-20 20:46:11,263][46][INFO] duration: 1435
[2023-12-20 20:46:11,263][47][INFO] prompt-tokens/second: 324.5686411149826
[2023-12-20 20:46:11,263][48][INFO] completion-tokens/second: 106.93449477351916
[2023-12-20 20:46:11,263][49][INFO] prompt-chars/second: 184.3177700348432
[2023-12-20 20:46:11,263][50][INFO] completion-chars/second: 152.89059233449478
[2023-12-20 20:46:11,263][51][INFO] total completion tokens: 153451
[2023-12-20 20:46:11,263][52][INFO] completion tokens per request: 314.44877049180326
[2023-12-20 20:46:11,263][53][INFO] n-request: 488
[2023-12-20 20:46:11,263][54][INFO] QPS: 0.3400696864111498
[2023-12-20 20:46:11,263][55][INFO] tokens-speed-per-request/second(终端用户视角): 4.911819184048167
[2023-12-20 20:46:11,263][247][INFO] None
[2023-12-20 20:46:11,263][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 20:46:11,265][261][INFO] chunk_size: 500, generate_size: 100
[2023-12-20 21:04:43,230][243][INFO] 总测试文本块数目: 500
[2023-12-20 21:04:43,231][244][INFO] 并发: 25
[2023-12-20 21:04:43,231][245][INFO] 单个文本块长度: 500
[2023-12-20 21:04:43,231][246][INFO] 生成文本长度: 100
[2023-12-20 21:04:43,231][46][INFO] duration: 1112
[2023-12-20 21:04:43,231][47][INFO] prompt-tokens/second: 428.36870503597123
[2023-12-20 21:04:43,231][48][INFO] completion-tokens/second: 95.24010791366906
[2023-12-20 21:04:43,231][49][INFO] prompt-chars/second: 243.21762589928056
[2023-12-20 21:04:43,231][50][INFO] completion-chars/second: 139.52338129496403
[2023-12-20 21:04:43,231][51][INFO] total completion tokens: 105907
[2023-12-20 21:04:43,231][52][INFO] completion tokens per request: 212.23847695390782
[2023-12-20 21:04:43,231][53][INFO] n-request: 499
[2023-12-20 21:04:43,232][54][INFO] QPS: 0.4487410071942446
[2023-12-20 21:04:43,232][55][INFO] tokens-speed-per-request/second(终端用户视角): 3.9400043684352024
[2023-12-20 21:04:43,232][247][INFO] None
[2023-12-20 21:04:43,232][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 21:04:43,239][261][INFO] chunk_size: 100, generate_size: 4000
[2023-12-20 21:24:17,889][243][INFO] 总测试文本块数目: 500
[2023-12-20 21:24:17,889][244][INFO] 并发: 32
[2023-12-20 21:24:17,889][245][INFO] 单个文本块长度: 100
[2023-12-20 21:24:17,889][246][INFO] 生成文本长度: 4000
[2023-12-20 21:24:17,889][46][INFO] duration: 1174
[2023-12-20 21:24:17,889][47][INFO] prompt-tokens/second: 249.28449744463373
[2023-12-20 21:24:17,889][48][INFO] completion-tokens/second: 149.45826235093696
[2023-12-20 21:24:17,889][49][INFO] prompt-chars/second: 59.19761499148211
[2023-12-20 21:24:17,889][50][INFO] completion-chars/second: 225.61499148211243
[2023-12-20 21:24:17,889][51][INFO] total completion tokens: 175464
[2023-12-20 21:24:17,889][52][INFO] completion tokens per request: 361.037037037037
[2023-12-20 21:24:17,889][53][INFO] n-request: 486
[2023-12-20 21:24:17,889][54][INFO] QPS: 0.41396933560477
[2023-12-20 21:24:17,889][55][INFO] tokens-speed-per-request/second(终端用户视角): 5.534838376324624
[2023-12-20 21:24:17,889][247][INFO] None
[2023-12-20 21:24:17,889][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 21:24:17,891][261][INFO] chunk_size: 100, generate_size: 2000
[2023-12-20 21:42:08,088][243][INFO] 总测试文本块数目: 500
[2023-12-20 21:42:08,088][244][INFO] 并发: 32
[2023-12-20 21:42:08,088][245][INFO] 单个文本块长度: 100
[2023-12-20 21:42:08,088][246][INFO] 生成文本长度: 2000
[2023-12-20 21:42:08,088][46][INFO] duration: 1071
[2023-12-20 21:42:08,088][47][INFO] prompt-tokens/second: 279.4453781512605
[2023-12-20 21:42:08,088][48][INFO] completion-tokens/second: 138.0233426704015
[2023-12-20 21:42:08,088][49][INFO] prompt-chars/second: 66.359477124183
[2023-12-20 21:42:08,088][50][INFO] completion-chars/second: 208.69654528478057
[2023-12-20 21:42:08,088][51][INFO] total completion tokens: 147823
[2023-12-20 21:42:08,088][52][INFO] completion tokens per request: 297.430583501006
[2023-12-20 21:42:08,088][53][INFO] n-request: 497
[2023-12-20 21:42:08,088][54][INFO] QPS: 0.46405228758169936
[2023-12-20 21:42:08,089][55][INFO] tokens-speed-per-request/second(终端用户视角): 5.0271725525662285
[2023-12-20 21:42:08,089][247][INFO] None
[2023-12-20 21:42:08,089][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 21:42:08,090][261][INFO] chunk_size: 100, generate_size: 1000
[2023-12-20 21:58:58,019][243][INFO] 总测试文本块数目: 500
[2023-12-20 21:58:58,019][244][INFO] 并发: 32
[2023-12-20 21:58:58,019][245][INFO] 单个文本块长度: 100
[2023-12-20 21:58:58,019][246][INFO] 生成文本长度: 1000
[2023-12-20 21:58:58,019][46][INFO] duration: 1010
[2023-12-20 21:58:58,019][47][INFO] prompt-tokens/second: 293.93564356435644
[2023-12-20 21:58:58,019][48][INFO] completion-tokens/second: 119.07029702970297
[2023-12-20 21:58:58,019][49][INFO] prompt-chars/second: 69.8009900990099
[2023-12-20 21:58:58,019][50][INFO] completion-chars/second: 177.73564356435642
[2023-12-20 21:58:58,019][51][INFO] total completion tokens: 120261
[2023-12-20 21:58:58,019][52][INFO] completion tokens per request: 243.9371196754564
[2023-12-20 21:58:58,019][53][INFO] n-request: 493
[2023-12-20 21:58:58,019][54][INFO] QPS: 0.4881188118811881
[2023-12-20 21:58:58,019][55][INFO] tokens-speed-per-request/second(终端用户视角): 4.712607656220286
[2023-12-20 21:58:58,019][247][INFO] None
[2023-12-20 21:58:58,020][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 21:58:58,021][261][INFO] chunk_size: 100, generate_size: 500
[2023-12-20 22:12:33,681][243][INFO] 总测试文本块数目: 500
[2023-12-20 22:12:33,682][244][INFO] 并发: 32
[2023-12-20 22:12:33,682][245][INFO] 单个文本块长度: 100
[2023-12-20 22:12:33,682][246][INFO] 生成文本长度: 500
[2023-12-20 22:12:33,682][46][INFO] duration: 815
[2023-12-20 22:12:33,682][47][INFO] prompt-tokens/second: 368.06503067484664
[2023-12-20 22:12:33,682][48][INFO] completion-tokens/second: 113.67975460122699
[2023-12-20 22:12:33,682][49][INFO] prompt-chars/second: 86.94233128834355
[2023-12-20 22:12:33,682][50][INFO] completion-chars/second: 171.37668711656443
[2023-12-20 22:12:33,682][51][INFO] total completion tokens: 92649
[2023-12-20 22:12:33,682][52][INFO] completion tokens per request: 185.66933867735472
[2023-12-20 22:12:33,682][53][INFO] n-request: 499
[2023-12-20 22:12:33,682][54][INFO] QPS: 0.6122699386503068
[2023-12-20 22:12:33,682][55][INFO] tokens-speed-per-request/second(终端用户视角): 4.055331838733575
[2023-12-20 22:12:33,682][247][INFO] None
[2023-12-20 22:12:33,682][248][INFO] ------------------------------------------------------------------------------------------------------------------------
[2023-12-20 22:12:33,684][261][INFO] chunk_size: 100, generate_size: 100
[2023-12-20 22:24:28,509][243][INFO] 总测试文本块数目: 500
[2023-12-20 22:24:28,509][244][INFO] 并发: 32
[2023-12-20 22:24:28,509][245][INFO] 单个文本块长度: 100
[2023-12-20 22:24:28,509][246][INFO] 生成文本长度: 100
[2023-12-20 22:24:28,509][46][INFO] duration: 715
[2023-12-20 22:24:28,510][47][INFO] prompt-tokens/second: 420.393006993007
[2023-12-20 22:24:28,510][48][INFO] completion-tokens/second: 120.22937062937064
[2023-12-20 22:24:28,510][49][INFO] prompt-chars/second: 99.3006993006993
[2023-12-20 22:24:28,510][50][INFO] completion-chars/second: 181.1986013986014
[2023-12-20 22:24:28,510][51][INFO] total completion tokens: 85964
[2023-12-20 22:24:28,510][52][INFO] completion tokens per request: 171.928
[2023-12-20 22:24:28,510][53][INFO] n-request: 500
[2023-12-20 22:24:28,510][54][INFO] QPS: 0.6993006993006993
[2023-12-20 22:24:28,510][55][INFO] tokens-speed-per-request/second(终端用户视角): 3.8556273561774557
[2023-12-20 22:24:28,510][247][INFO] None
[2023-12-20 22:24:28,510][248][INFO] ------------------------------------------------------------------------------------------------------------------------
```
